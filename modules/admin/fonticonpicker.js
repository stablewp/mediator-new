!function(t){"use strict";var i={theme:"fip-grey",source:!1,color:!1,highlight:!1,emptyIcon:!0,emptyIconValue:"",iconsPerPage:25,hasSearch:!0,searchSource:!1,useAttribute:!1,attributeName:"data-icon",convertToHex:!0,allCategoryText:"From all categories",unCategorizedText:"Uncategorized"};function e(e,s){this.element=t(e),this.settings=t.extend({},i,s),this.settings.emptyIcon&&this.settings.iconsPerPage--,this.iconPicker=t("<div/>",{class:"icons-selector","data-dbicon":t(e).attr("data-icon"),"data-dbcolor":t(e).attr("data-color"),"data-dbhighlight":t(e).attr("data-highlight"),style:"position: relative",html:'<div class="selector"><span class="selected-icon"><i class="fip-icon-block"></i></span><span class="selector-button"><i class="fip-icon-down-dir"></i></span></div><div class="selector-popup" style="display: none;">'+(this.settings.hasSearch?'<div class="selector-search"><input type="text" name="" value="" placeholder="Search icon" class="icons-search-input"/><i class="fip-icon-search"></i></div>':"")+'<div class="selector-category"><select name="" class="icon-category-select" style="display: none"></select></div><div class="fip-icons-container"></div><div class="selector-footer" style="display:none;"><span class="selector-pages">1/2</span><span class="selector-arrows"><span class="selector-arrow-left" style="display:none;"><i class="fip-icon-left-dir"></i></span><span class="selector-arrow-right"><i class="fip-icon-right-dir"></i></span></span></div></div>'}),this.iconContainer=this.iconPicker.find(".fip-icons-container"),this.searchIcon=this.iconPicker.find(".selector-search i"),this.iconsSearched=[],this.isSearch=!1,this.totalPage=1,this.currentPage=1,this.currentIcon=!1,this.iconsCount=0,this.open=!1,this.searchValues=[],this.availableCategoriesSearch=[],this.triggerEvent=null,this.backupSource=[],this.backupSearch=[],this.isCategorized=!1,this.selectCategory=this.iconPicker.find(".icon-category-select"),this.selectedCategory=!1,this.availableCategories=[],this.unCategorizedKey=null,this.init();var n=this;t(".icons-selector").each(function(){var i=t(this).parent().find('select option[value="'+t(this).attr("data-dbicon")+'"]').attr("data-color"),e=t(this).parent().find('select option[value="'+t(this).attr("data-dbicon")+'"]').attr("data-highlight");i||(i="false"),e||(e="false"),n.setSelectedIcon(t(this).attr("data-dbicon"),i,e)})}e.prototype={init:function(){this.iconPicker.addClass(this.settings.theme),this.iconPicker.css({left:-9999}).appendTo("body");var i=this.iconPicker.outerHeight(),e=this.iconPicker.outerWidth();if(this.iconPicker.css({left:""}),this.element.before(this.iconPicker),this.element.css({visibility:"hidden",top:0,position:"relative",zIndex:"-1",left:"-"+e+"px",display:"inline-block",height:i+"px",width:e+"px",padding:"0",margin:"0 -"+e+"px 0 0",border:"0 none",verticalAlign:"top"}),!this.element.is("select")){var s=function(){for(var t=3,i=document.createElement("div"),e=i.all||[];i.innerHTML="\x3c!--[if gt IE "+ ++t+"]><br><![endif]--\x3e",e[0];);return t>4?t:!t}(),n=document.createElement("div");this.triggerEvent=9!==s&&"oninput"in n?["input","keyup"]:["keyup"]}this.settings.source=[],this.settings.color=[],this.settings.highlight=[],this.settings.searchSource=[],this.element.find("option").each(t.proxy(function(i,e){var s=t(e).val(),n=t(e).html(),c=!!t(e).attr("data-color")&&t(e).attr("data-color"),o=!!t(e).attr("data-highlight")&&t(e).attr("data-highlight");s&&(this.settings.source.push(s),this.settings.color.push(c),this.settings.highlight.push(o),this.searchValues.push(n))},this)),this.backupSource=this.settings.source.slice(0),this.backupSearch=this.searchValues.slice(0),this.loadCategories(),this.loadIcons(),this.selectCategory.on("change keyup",t.proxy(function(i){if(!1===this.isCategorized)return!1;var e=t(i.currentTarget),s=e.val();if("all"===e.val())this.settings.source=this.backupSource,this.searchValues=this.backupSearch;else{var n=parseInt(s,10);this.availableCategories[n]&&(this.settings.source=this.availableCategories[n],this.searchValues=this.availableCategoriesSearch[n])}this.resetSearch(),this.loadIcons()},this)),this.iconPicker.find(".selector-button").click(t.proxy(function(){this.toggleIconSelector()},this)),this.iconPicker.find(".selector-arrow-right").click(t.proxy(function(i){this.currentPage<this.totalPage&&(this.iconPicker.find(".selector-arrow-left").show(),this.currentPage=this.currentPage+1,this.renderIconContainer()),this.currentPage===this.totalPage&&t(i.currentTarget).hide()},this)),this.iconPicker.find(".selector-arrow-left").click(t.proxy(function(i){this.currentPage>1&&(this.iconPicker.find(".selector-arrow-right").show(),this.currentPage=this.currentPage-1,this.renderIconContainer()),1===this.currentPage&&t(i.currentTarget).hide()},this)),this.iconPicker.find(".icons-search-input").keyup(t.proxy(function(i){var e=t(i.currentTarget).val();""!==e?(this.searchIcon.removeClass("fip-icon-search"),this.searchIcon.addClass("fip-icon-cancel"),this.isSearch=!0,this.currentPage=1,this.iconsSearched=[],t.grep(this.searchValues,t.proxy(function(t,i){if(t.toLowerCase().search(e.toLowerCase())>=0)return this.iconsSearched[this.iconsSearched.length]=this.settings.source[i],!0},this)),this.renderIconContainer()):this.resetSearch()},this)),this.iconPicker.find(".selector-search").on("click",".fip-icon-cancel",t.proxy(function(){this.iconPicker.find(".icons-search-input").focus(),this.resetSearch()},this)),this.iconContainer.on("click",".fip-box",t.proxy(function(i){this.setSelectedIcon(t(i.currentTarget).find("i").attr("data-fip-value"),t(i.currentTarget).attr("data-color"),t(i.currentTarget).attr("data-highlight")),this.toggleIconSelector()},this)),this.iconPicker.click(function(t){return t.stopPropagation(),!1}),t("html").click(t.proxy(function(){this.open&&this.toggleIconSelector()},this))},initSourceIndex:function(){if("object"==typeof this.settings.source){if(t.isArray(this.settings.source))this.isCategorized=!1,this.selectCategory.html("").hide(),this.settings.source=t.map(this.settings.source,function(t,i){return"function"==typeof t.toString?t.toString():t}),t.isArray(this.settings.searchSource)?this.searchValues=t.map(this.settings.searchSource,function(t,i){return"function"==typeof t.toString?t.toString():t}):this.searchValues=this.settings.source.slice(0);else{var i=t.extend(!0,{},this.settings.source);for(var e in this.settings.source=[],this.searchValues=[],this.availableCategoriesSearch=[],this.selectedCategory=!1,this.availableCategories=[],this.unCategorizedKey=null,this.isCategorized=!0,this.selectCategory.html(""),i){var s=this.availableCategories.length,n=t("<option />");for(var c in n.attr("value",s),n.html(e),this.selectCategory.append(n),this.availableCategories[s]=[],this.availableCategoriesSearch[s]=[],i[e]){var o=i[e][c],r=this.settings.searchSource&&this.settings.searchSource[e]&&this.settings.searchSource[e][c]?this.settings.searchSource[e][c]:o;"function"==typeof o.toString&&(o=o.toString()),o&&o!==this.settings.emptyIconValue&&(this.settings.source.push(o),this.availableCategories[s].push(o),this.searchValues.push(r),this.availableCategoriesSearch[s].push(r))}}}this.backupSource=this.settings.source.slice(0),this.backupSearch=this.searchValues.slice(0),this.loadCategories()}},loadCategories:function(){!1!==this.isCategorized&&(t('<option value="all">'+this.settings.allCategoryText+"</option>").prependTo(this.selectCategory),this.selectCategory.show().val("all").trigger("change"))},loadIcons:function(){this.iconContainer.html('<i class="fip-icon-spin3 animate-spin loading"></i>'),this.settings.source instanceof Array&&this.renderIconContainer()},renderIconContainer:function(){var i,e=[];if(e=this.isSearch?this.iconsSearched:this.settings.source,this.iconsCount=e.length,this.totalPage=Math.ceil(this.iconsCount/this.settings.iconsPerPage),this.totalPage>1?this.iconPicker.find(".selector-footer").show():this.iconPicker.find(".selector-footer").hide(),this.iconPicker.find(".selector-pages").html(this.currentPage+"/"+this.totalPage+" <em>("+this.iconsCount+")</em>"),i=(this.currentPage-1)*this.settings.iconsPerPage,this.settings.emptyIcon)this.iconContainer.html('<span class="fip-box"><i class="fip-icon-block" data-fip-value="fip-icon-block"></i></span>');else{if(e.length<1)return void this.iconContainer.html('<span class="icons-picker-error"><i class="fip-icon-block" data-fip-value="fip-icon-block"></i></span>');this.iconContainer.html("")}e=e.slice(i,i+this.settings.iconsPerPage);for(var s,n=0;s=e[n++];){var c=s;t.grep(this.settings.source,t.proxy(function(t,i){return t===s&&(c=this.searchValues[i],!0)},this));var o=this.settings.color[n-1],r=this.settings.highlight[n-1];t("<span/>",{html:'<i data-fip-value="'+s+'" '+(this.settings.useAttribute?this.settings.attributeName+'="'+(this.settings.convertToHex?"&#x"+parseInt(s,10).toString(16)+";":s)+'"':'class="'+s+'"')+'></i><div class="half-panel" style="background-color:'+r+'"></div>',class:"fip-box",style:"background-color:"+o,"data-color":o,"data-highlight":r,title:c}).appendTo(this.iconContainer)}this.settings.emptyIcon||this.element.val()&&-1!==t.inArray(this.element.val(),this.settings.source)?-1===t.inArray(this.element.val(),this.settings.source)?this.setSelectedIcon():this.setSelectedIcon(this.element.val()):this.setSelectedIcon(e[0])},setHighlightedIcon:function(){this.iconContainer.find(".current-icon").removeClass("current-icon"),this.currentIcon&&this.iconContainer.find('[data-fip-value="'+this.currentIcon+'"]').parent("span").addClass("current-icon")},setSelectedIcon:function(t,i,e){if(this.iconPicker.find(".selected-icon").removeClass("icon-today icon-full icon-half icon-pending icon-pending-half"),"false"!=i?(this.iconPicker.find(".selected-icon").css("background-color",i),this.iconPicker.find(".selected-icon").addClass(t)):this.iconPicker.find(".selected-icon").css("background-color","transparent"),"fip-icon-block"===t&&(t=""),this.settings.useAttribute?t?this.iconPicker.find(".selected-icon").html("<i "+this.settings.attributeName+'="'+(this.settings.convertToHex?"&#x"+parseInt(t,10).toString(16)+";":t)+'"></i>'):this.iconPicker.find(".selected-icon").html('<i class="fip-icon-block"></i>'):this.iconPicker.find(".selected-icon").html('<i class="'+(t||"fip-icon-block")+'"></i>'),e?this.iconPicker.find(".selected-icon i").css("background-color",e):this.iconPicker.find(".selected-icon i").css("background-color","transparent"),this.element.val(""===t?this.settings.emptyIconValue:t).trigger("change"),null!==this.triggerEvent)for(var s in this.triggerEvent)this.element.trigger(this.triggerEvent[s]);this.currentIcon=t,this.setHighlightedIcon()},toggleIconSelector:function(){this.open=this.open?0:1,this.iconPicker.find(".selector-popup").slideToggle(300),this.iconPicker.find(".selector-button i").toggleClass("fip-icon-down-dir"),this.iconPicker.find(".selector-button i").toggleClass("fip-icon-up-dir"),this.open&&this.iconPicker.find(".icons-search-input").focus().select()},resetSearch:function(){this.iconPicker.find(".icons-search-input").val(""),this.searchIcon.removeClass("fip-icon-cancel"),this.searchIcon.addClass("fip-icon-search"),this.iconPicker.find(".selector-arrow-left").hide(),this.currentPage=1,this.isSearch=!1,this.renderIconContainer(),this.totalPage>1&&this.iconPicker.find(".selector-arrow-right").show()}},t.fn.bkfontIconPicker=function(i){return this.each(function(){t.data(this,"bkfontIconPicker")||t.data(this,"bkfontIconPicker",new e(this,i))}),this.setIcons=t.proxy(function(i,e){void 0===i&&(i=!1),void 0===e&&(e=!1),this.each(function(){t.data(this,"bkfontIconPicker").settings.source=i,t.data(this,"bkfontIconPicker").settings.searchSource=e,t.data(this,"bkfontIconPicker").initSourceIndex(),t.data(this,"bkfontIconPicker").resetSearch(),t.data(this,"bkfontIconPicker").loadIcons()})},this),this.destroyPicker=t.proxy(function(){this.each(function(){t.data(this,"bkfontIconPicker")&&(t.data(this,"bkfontIconPicker").iconPicker.remove(),t.data(this,"bkfontIconPicker").element.css({visibility:"",top:"",position:"",zIndex:"",left:"",display:"",height:"",width:"",padding:"",margin:"",border:"",verticalAlign:""}),t.removeData(this,"bkfontIconPicker"))})},this),this.refreshPicker=t.proxy(function(s){s||(s=i),this.destroyPicker(),this.each(function(){t.data(this,"bkfontIconPicker")||t.data(this,"bkfontIconPicker",new e(this,s))})},this),this}}(jQuery);